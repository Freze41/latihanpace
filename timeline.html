<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rama ‚Äî Session Timeline + Mini Map</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet" />
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
  --bg-main:#050510;
  --bg-card:#0b0b18;
  --accent-cyan:#00eaff;
  --accent-magenta:#ff4dff;
  --accent-lime:#b0ff4d;
  --text-soft:#d6e6ff;
  --border-soft:#242444;
}
*{box-sizing:border-box;}
body{
  margin:0;
  padding:0;
  background:radial-gradient(circle at 10% 0%,#11112a 0,#050510 45%,#02020a 100%);
  font-family:'Rajdhani',sans-serif;
  color:var(--text-soft);
}

/* HEADER */
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px;
  background:linear-gradient(90deg,#05050c,#0c0c1c,#05050c);
  border-bottom:1px solid #161633;
  color:var(--accent-cyan);
  text-shadow:0 0 10px var(--accent-cyan);
  font-family:'Orbitron',sans-serif;
}
header .left{
  display:flex;align-items:center;gap:10px;
}
header .icon{font-size:24px;}
header .title-main{font-size:18px;letter-spacing:0.16em;}
header .title-sub{font-size:10px;letter-spacing:0.18em;color:#9fdcff;text-transform:uppercase;}
header a{
  font-size:11px;
  color:#9feaff;
  text-decoration:none;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid #2a2a42;
  background:rgba(5,5,20,0.7);
}

/* CONTAINER */
main{
  max-width:780px;
  margin:16px auto 40px;
  padding:0 12px;
}

/* TIMELINE HEADER */
.timeline-header{
  margin-bottom:10px;
}
.timeline-header h1{
  margin:0;
  font-size:18px;
  letter-spacing:0.08em;
  text-transform:uppercase;
  color:#e8ffff;
}
.timeline-header p{
  margin:4px 0 0;
  font-size:12px;
  color:#a8b8ff;
}

/* SUMMARY BADGES */
.summary-strip{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin:10px 0 14px;
  font-size:11px;
}
.badge{
  padding:4px 10px;
  border-radius:999px;
  border:1px solid #2a2a44;
  background:#060612;
}
.badge-strong{border-color:#b0ff4d;background:#0c1810;color:#eaffd6;}
.badge-warn{border-color:#ffb84d;background:#201308;color:#ffe8c4;}

/* TIMELINE WRAP */
.timeline{
  position:relative;
  margin-top:6px;
  padding-left:18px;
}
.timeline::before{
  content:"";
  position:absolute;
  left:11px;
  top:0;
  bottom:0;
  width:2px;
  background:linear-gradient(to bottom,#00eaff,#ff4dff);
  opacity:0.5;
}

/* ITEM */
.item{
  position:relative;
  margin-bottom:16px;
}
.item:last-child{margin-bottom:6px;}
.item-dot{
  position:absolute;
  left:-1px;
  top:6px;
  width:14px;height:14px;
  border-radius:50%;
  border:2px solid #00eaff;
  background:#050510;
  box-shadow:0 0 10px #00eaffaa;
}
.item-dot.easy{border-color:#4ddfff;}
.item-dot.tempo{border-color:#ff8dff;}
.item-dot.interval{border-color:#ff6a7f;}
.item-dot.long{border-color:#b0ff4d;}
.item-dot.rest{border-color:#b0b0cc;box-shadow:none;}

.card{
  margin-left:14px;
  background:var(--bg-card);
  border-radius:12px;
  border:1px solid var(--border-soft);
  padding:9px 10px 10px;
  box-shadow:0 0 12px #000000c0;
}
.card-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:8px;
}
.date-label{
  font-size:11px;
  color:#9feaff;
  text-transform:uppercase;
  letter-spacing:0.12em;
}
.type-label{
  font-size:13px;
  font-weight:600;
}
.type-label span{
  font-size:11px;
  opacity:0.8;
  margin-left:4px;
}
.type-easy{color:#4ddfff;}
.type-tempo{color:#ff8dff;}
.type-interval{color:#ff6a7f;}
.type-long{color:#b0ff4d;}
.type-rest{color:#b0b0cc;}

.pill{
  font-size:10px;
  padding:2px 7px;
  border-radius:999px;
  border:1px solid #2a2a44;
  background:#060612;
  color:#cfd7ff;
}
.pill-key{border-color:#ffb84d;background:#201308;color:#ffe8c4;}
.pill-support{border-color:#4ddfff80;background:#061520;color:#d6f7ff;}
.pill-rest{border-color:#b0b0cc;background:#1a1a26;color:#f0f0ff;}

.card-body{
  margin-top:6px;
  font-size:12px;
  color:#e8ffff;
}
.target{
  font-size:11px;
  color:#a8dfff;
}
.row{
  margin-top:4px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  font-size:11px;
}
.row span{white-space:nowrap;}
.label{color:#9fa8ff;}

.comment{
  margin-top:6px;
  font-size:11px;
  color:#cfd7ff;
  background:#15152a;
  border-left:3px solid #00eaff;
  border-radius:4px;
  padding:4px 6px;
}

/* MINI MAP + CONTROLS */
.mini-map-wrap{
  margin-top:6px;
}
.mini-map{
  margin-top:4px;
  height:150px;
  border-radius:10px;
  overflow:hidden;
  background:#050510;
  box-shadow:0 0 10px #00eaff55;
}
.map-placeholder{
  font-size:11px;
  color:#9399c8;
  padding:6px 4px;
}
.map-controls{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:4px;
  gap:8px;
}
.map-btn{
  font-size:10px;
  padding:3px 9px;
  border-radius:999px;
  border:1px solid #2a2a44;
  background:#060612;
  color:#9feaff;
  cursor:pointer;
}
.map-btn:hover{
  border-color:#00eaff;
  box-shadow:0 0 6px #00eaff66;
}
.map-status{
  font-size:10px;
  color:#a8b8ff;
}

/* EMPTY */
.empty{
  margin-top:20px;
  font-size:13px;
  color:#b3c0ff;
  background:#060612;
  border:1px dashed #2a2a44;
  border-radius:10px;
  padding:10px 12px;
}

/* FOOTER */
footer{
  font-size:10px;
  text-align:center;
  color:#8c9aff;
  padding:12px 0 18px;
  opacity:0.8;
}
</style>
</head>
<body>

<header>
  <div class="left">
    <div class="icon">üßµ</div>
    <div>
      <div class="title-main">RAMA TRAINING THREADS</div>
      <div class="title-sub">SESSION TIMELINE + MINI MAP</div>
    </div>
  </div>
  <!-- Ganti href ini sesuai nama file halaman utama -->
  <a href="index.html">‚Üê Kembali ke Kalender</a>
</header>

<main>
  <div class="timeline-header">
    <h1>Session Timeline</h1>
    <p>Feed semua sesi yang sudah kamu log ‚Äî lengkap dengan mini map & animasi rute ala ‚Äúvideo‚Äù, tapi warna tetap cyberpunk.</p>
  </div>

  <div id="summary" class="summary-strip"></div>

  <div id="timeline" class="timeline"></div>

  <div id="emptyState" class="empty" style="display:none;">
    Belum ada sesi yang terekam di timeline.<br>
    Log dulu latihan di kalender utama (plus upload TCX), lalu balik ke sini.  
    Strava boleh keren, tapi ‚ÄúRama App‚Äù ini nggak kalah lah üòè
  </div>
</main>

<footer>
  Data diambil dari localStorage: <code>runnaUltraLogs</code> &amp; (opsional) <code>runnaUltraRoutes</code>.<br>
  Edit log & upload TCX tetap dari halaman utama.
</footer>

<script>
/* ======= PLAN (3‚Äì31 Des) ‚Äì ringkas ======= */
const plan = [
  {day:3,  type:'Easy',    title:'Easy Run 30 menit',       pace:'7:10‚Äì7:40', block:'support'},
  {day:4,  type:'Easy',    title:'Easy Run 40 menit',       pace:'7:10‚Äì7:30', block:'support'},
  {day:5,  type:'Interval',title:'Interval 6√ó200m',         pace:'5:00‚Äì5:20', block:'key'},
  {day:6,  type:'Easy',    title:'Recovery Run',            pace:'7:20‚Äì7:50', block:'support'},
  {day:7,  type:'Tempo',   title:'Tempo 15 menit',          pace:'6:15‚Äì6:25', block:'key'},
  {day:8,  type:'Rest',    title:'Rest Day',                pace:'-',         block:'rest'},
  {day:9,  type:'Interval',title:'Interval 4√ó400m',         pace:'5:20‚Äì5:30', block:'key'},
  {day:10, type:'Long',    title:'Long Run 8‚Äì10 km',        pace:'7:00‚Äì7:30', block:'key'},
  {day:11, type:'Easy',    title:'Recovery Run 30 menit',   pace:'7:20‚Äì7:50', block:'support'},
  {day:12, type:'Tempo',   title:'Steady 25‚Äì30 menit',      pace:'6:30‚Äì6:50', block:'key'},
  {day:13, type:'Easy',    title:'Easy Run',                pace:'7:10‚Äì7:40', block:'support'},
  {day:14, type:'Tempo',   title:'Tempo 2√ó8 menit',         pace:'6:00‚Äì6:15', block:'key'},
  {day:15, type:'Rest',    title:'Rest Day',                pace:'-',         block:'rest'},
  {day:16, type:'Interval',title:'Test 1 km',               pace:'5:10‚Äì5:40', block:'key'},
  {day:17, type:'Easy',    title:'Easy Shakeout',           pace:'7:10‚Äì7:40', block:'support'},
  {day:18, type:'Interval',title:'Interval 5√ó400m',         pace:'5:10‚Äì5:25', block:'key'},
  {day:19, type:'Rest',    title:'Rest Day',                pace:'-',         block:'rest'},
  {day:20, type:'Tempo',   title:'Steady 30 menit',         pace:'6:30‚Äì6:50', block:'key'},
  {day:21, type:'Long',    title:'Long Run 9‚Äì10 km',        pace:'7:00‚Äì7:40', block:'key'},
  {day:22, type:'Easy',    title:'Recovery Run 30 menit',   pace:'7:20‚Äì7:50', block:'support'},
  {day:23, type:'Tempo',   title:'Tempo 12‚Äì15 menit',       pace:'6:05‚Äì6:20', block:'key'},
  {day:24, type:'Easy',    title:'Easy Run',                pace:'7:10‚Äì7:40', block:'support'},
  {day:25, type:'Interval',title:'Interval 6√ó200m',         pace:'5:00‚Äì5:20', block:'key'},
  {day:26, type:'Interval',title:'Interval 4‚Äì6√ó400m',       pace:'5:05‚Äì5:20', block:'key'},
  {day:27, type:'Long',    title:'Long Run 8‚Äì9 km',         pace:'7:00‚Äì7:30', block:'key'},
  {day:28, type:'Rest',    title:'Rest Day',                pace:'-',         block:'rest'},
  {day:29, type:'Easy',    title:'Easy Run',                pace:'7:10‚Äì7:40', block:'support'},
  {day:30, type:'Tempo',   title:'Tempo 2√ó10 menit',        pace:'6:00‚Äì6:10', block:'key'},
  {day:31, type:'Interval',title:'Final Test 1 km',         pace:'4:50‚Äì5:20', block:'key'}
];

/* ======= UTIL ======= */
function formatPace(sec){
  if(sec==null || isNaN(sec)) return '-';
  const m = Math.floor(sec/60);
  const s = sec%60;
  return m+':' + (s<10?'0'+s:s);
}
function formatDuration(sec){
  if(sec==null || isNaN(sec)) return '-';
  const h = Math.floor(sec/3600);
  const m = Math.floor((sec%3600)/60);
  const s = Math.floor(sec%60);
  if(h>0) return `${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
  return `${m}:${s.toString().padStart(2,'0')}`;
}
function typeClass(type){
  if(type==='Easy') return 'easy';
  if(type==='Tempo') return 'tempo';
  if(type==='Interval') return 'interval';
  if(type==='Long') return 'long';
  if(type==='Rest') return 'rest';
  return '';
}
function typeLabelCls(type){
  if(type==='Easy') return 'type-easy';
  if(type==='Tempo') return 'type-tempo';
  if(type==='Interval') return 'type-interval';
  if(type==='Long') return 'type-long';
  if(type==='Rest') return 'type-rest';
  return '';
}
function blockLabel(block){
  if(block==='key') return {cls:'pill-key',text:'Key Session'};
  if(block==='support') return {cls:'pill-support',text:'Support'};
  if(block==='rest') return {cls:'pill-rest',text:'Rest'};
  return {cls:'pill',text:'Session'};
}
function rpeLabel(rpe){
  if(rpe==='easy') return 'Santai (3‚Äì4)';
  if(rpe==='moderate') return 'Lumayan (5‚Äì6)';
  if(rpe==='hard') return 'Berat (7‚Äì8)';
  if(rpe==='crazy') return 'Meledak (9‚Äì10)';
  return '';
}

/* ======= LOAD LOGS & ROUTES from localStorage ======= */
let logs = {};
try{
  logs = JSON.parse(localStorage.getItem('runnaUltraLogs') || '{}');
}catch(e){
  logs = {};
}

let routeStore = {};
try{
  routeStore = JSON.parse(localStorage.getItem('runnaUltraRoutes') || '{}');
}catch(e){
  routeStore = {};
}

/*
   getRouteLatLngs()
   üëâ UTAMA: baca dari logs[day].route (yang di-save index.html sekarang)
   üëâ CADANGAN: kalau suatu saat kamu pakai runnaUltraRoutes, tetap bisa dibaca.
*/
function getRouteLatLngs(day){
  let pts = null;

  const log = logs[day];
  if(log && Array.isArray(log.route)) pts = log.route;

  if((!pts || !pts.length) && routeStore[day]){
    const r = routeStore[day];
    pts = r.latlng || r.coords || r.points || r.route || [];
  }

  if(!Array.isArray(pts) || !pts.length) return null;

  const cleaned = [];
  for(const p of pts){
    if(Array.isArray(p) && p.length>=2){
      const lat = Number(p[0]), lng = Number(p[1]);
      if(!isNaN(lat) && !isNaN(lng)) cleaned.push([lat,lng]);
    }else if(p && typeof p==='object' && p.lat!=null && p.lng!=null){
      const lat = Number(p.lat), lng = Number(p.lng);
      if(!isNaN(lat) && !isNaN(lng)) cleaned.push([lat,lng]);
    }
  }
  return cleaned.length ? cleaned : null;
}

/* ======= MAP ANIMATION STATE ======= */
const mapStates = {}; // day -> {map, poly, latlngs, playing, idx, rafId}

/* ======= BUILD TIMELINE ======= */
(function init(){
  const entries = [];
  Object.keys(logs).forEach(k=>{
    const day = Number(k);
    const p = plan.find(x=>x.day===day);
    if(!p) return;
    const lg = logs[k];
    entries.push({day,p,log:lg});
  });

  // ascending hari (3 ‚Üí 31)
  entries.sort((a,b)=>a.day-b.day);

  const timelineEl = document.getElementById('timeline');
  const emptyEl = document.getElementById('emptyState');
  const summaryEl = document.getElementById('summary');

  if(entries.length===0){
    emptyEl.style.display = 'block';
    timelineEl.innerHTML = '';
    summaryEl.innerHTML = '';
    return;
  }

  // ===== SUMMARY BADGES =====
  let totalDist = 0;
  let bestPace = null;
  let sumHR = 0, countHR = 0;
  let hardCount = 0;
  const shoeDist = {};

  entries.forEach(e=>{
    const {log,p} = e;
    if(log.dist!=null && !isNaN(log.dist)){
      totalDist += log.dist;
    }
    if(log.paceSec!=null && !isNaN(log.paceSec)){
      if(bestPace==null || log.paceSec<bestPace) bestPace = log.paceSec;
    }
    if(log.hr!=null && !isNaN(log.hr)){
      sumHR+=log.hr; countHR++;
    }
    if(p.type==='Tempo' || p.type==='Interval') hardCount++;

    if(log.shoe){
      const d = log.dist!=null && !isNaN(log.dist) ? log.dist : 0;
      shoeDist[log.shoe] = (shoeDist[log.shoe] || 0) + d;
    }
  });

  const avgHR = countHR? Math.round(sumHR/countHR) : null;
  const badges = [];

  badges.push(`<span class="badge badge-strong">Total ${entries.length} sesi ‚Ä¢ ${(totalDist||0).toFixed(1)} km</span>`);
  if(bestPace){
    badges.push(`<span class="badge">Best pace: ${formatPace(bestPace)} /km</span>`);
  }
  if(avgHR){
    badges.push(`<span class="badge">Rata-rata HR: ${avgHR} bpm</span>`);
  }
  if(hardCount>4){
    badges.push(`<span class="badge badge-warn">Sesi keras: ${hardCount}√ó ‚Ä¢ jaga recovery ya</span>`);
  }else if(hardCount>0){
    badges.push(`<span class="badge">Sesi keras: ${hardCount}√ó ‚Ä¢ balance oke</span>`);
  }

  const shoeNames = Object.keys(shoeDist);
  if(shoeNames.length){
    const top = shoeNames
      .map(name => ({name, dist: shoeDist[name]}))
      .sort((a,b)=>b.dist-a.dist)
      .slice(0, 2);

    top.forEach(s=>{
      badges.push(`<span class="badge">Sepatu ${s.name}: ${s.dist.toFixed(1)} km</span>`);
    });
  }

  summaryEl.innerHTML = badges.join('');

  // ===== TIMELINE HTML =====
  let html = '';
  entries.forEach(e=>{
    const {day,p,log} = e;
    const pace = log.paceSec!=null? formatPace(log.paceSec)+' /km':'-';
    const dist = (log.dist!=null && !isNaN(log.dist))? log.dist.toFixed(2)+' km':'-';
    const hr   = (log.hr!=null && !isNaN(log.hr))? log.hr+' bpm':'-';
    const time = log.timeSec!=null? formatDuration(log.timeSec):'-';
    const rpe  = rpeLabel(log.rpe);
    const shoe = log.shoe || '';
    const note = log.note || '';
    const typeCls = typeClass(p.type);
    const typeLblCls = typeLabelCls(p.type);
    const blockInfo = blockLabel(p.block);
    const mapId = `map-${day}`;
    const hasRoute = !!getRouteLatLngs(day);

    let comment = '';

    if(p.type==='Easy'){
      if(log.paceSec && log.paceSec<360){
        comment = 'Easy-nya udah mirip tempo ü§£ turunin dikit gapapa, yang penting besok masih bisa lari.';
      }else{
        comment = 'Easy run yang beneran easy. Ini sesi yang diam-diam bikin engine kamu makin kuat.';
      }
    }else if(p.type==='Tempo'){
      comment = 'Tempo ini yang pelan-pelan dorong pace 5 kecil jadi kenyataan. Konsistensi > sekali kenceng.';
    }else if(p.type==='Interval'){
      comment = 'Interval bikin kaki kenal pace cepat. Jangan lupa pairing dengan easy run yang cukup.';
    }else if(p.type==='Long'){
      comment = 'Long run = tabungan endurance. Jaraknya nggak harus ekstrem, yang penting stabil.';
    }else if(p.type==='Rest'){
      comment = 'Rest day dicatat. Recovery itu bagian dari program, bukan tanda malas.';
    }

    html += `
      <div class="item">
        <div class="item-dot ${typeCls}"></div>
        <div class="card">
          <div class="card-header">
            <div>
              <div class="date-label">${day} Des ‚Ä¢ ${p.type}</div>
              <div class="type-label ${typeLblCls}">
                ${p.title}
                <span>Target: ${p.pace}</span>
              </div>
            </div>
            <div class="pill ${blockInfo.cls}">${blockInfo.text}</div>
          </div>
          <div class="card-body">
            <div class="target">Target coach: ${p.pace}</div>
            <div class="row">
              <span><span class="label">Jarak:</span> ${dist}</span>
              <span><span class="label">Waktu:</span> ${time}</span>
              <span><span class="label">Pace:</span> ${pace}</span>
              <span><span class="label">HR:</span> ${hr}</span>
            </div>

            ${(shoe || rpe) ? `
            <div class="row">
              ${shoe ? `<span><span class="label">Sepatu:</span> ${shoe}</span>` : ''}
              ${rpe ? `<span><span class="label">RPE:</span> ${rpe}</span>` : ''}
            </div>
            ` : ''}

            <div class="comment">
              ${comment}
              ${note ? `<br><span class="label">Catatan:</span> ${note}` : ''}
            </div>
            <div class="mini-map-wrap">
              <div class="map-controls">
                <button class="map-btn anim-btn" data-day="${day}" ${hasRoute ? '' : 'disabled'}>
                  ${hasRoute ? '‚ñ∂ Animate Route' : 'No TCX route'}
                </button>
                <div class="map-status" id="map-status-${day}">
                  ${hasRoute ? 'Idle ‚Ä¢ siap dianimasikan' : 'Belum ada route tersimpan'}
                </div>
              </div>
              <div class="mini-map" id="${mapId}">
                ${hasRoute ? '' : '<div class="map-placeholder">Upload TCX di halaman utama supaya route hari ini muncul di sini.</div>'}
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
  });

  timelineEl.innerHTML = html;

  // ===== INIT MINI MAPS =====
  entries.forEach(e=>{
    initMiniMap(e.day);
  });
})();

/* ======= MINI MAP + ANIMASI ======= */
function initMiniMap(day){
  const latlngs = getRouteLatLngs(day);
  const mapEl = document.getElementById(`map-${day}`);
  if(!mapEl || !latlngs) return;

  const map = L.map(mapEl, {
    zoomControl:false,
    attributionControl:false,
    dragging:false,
    scrollWheelZoom:false,
    doubleClickZoom:false,
    boxZoom:false,
    keyboard:false
  });

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom:18
  }).addTo(map);

  const poly = L.polyline([], {color:'#00eaff',weight:3}).addTo(map);

  L.circleMarker(latlngs[0], {radius:3,color:'#b0ff4d',fillColor:'#b0ff4d',fillOpacity:1}).addTo(map);
  if(latlngs.length>1){
    L.circleMarker(latlngs[latlngs.length-1], {radius:3,color:'#ff4dff',fillColor:'#ff4dff',fillOpacity:1}).addTo(map);
  }

  map.fitBounds(L.latLngBounds(latlngs), {padding:[6,6]});

  mapStates[day] = {
    map,
    poly,
    latlngs,
    playing:false,
    idx:0,
    rafId:null
  };
}

function startAnimation(day, btn){
  const st = mapStates[day];
  if(!st || !st.latlngs || !st.latlngs.length) return;

  st.poly.setLatLngs([st.latlngs[0]]);
  st.idx = 1;
  st.playing = true;
  const status = document.getElementById(`map-status-${day}`);
  if(status) status.textContent = 'Playing ‚Ä¢ animasi route berjalan...';
  btn.textContent = '‚è∏ Stop';

  if(st.rafId) cancelAnimationFrame(st.rafId);

  const step = ()=>{
    if(!st.playing) return;
    if(st.idx >= st.latlngs.length){
      st.playing = false;
      st.rafId = null;
      btn.textContent = '‚ñ∂ Replay';
      if(status) status.textContent = 'Selesai ‚Ä¢ route full tergambar';
      return;
    }
    const pts = st.poly.getLatLngs();
    pts.push(st.latlngs[st.idx]);
    st.poly.setLatLngs(pts);
    st.idx++;

    st.rafId = requestAnimationFrame(step);
  };

  st.rafId = requestAnimationFrame(step);
}

function stopAnimation(day, btn){
  const st = mapStates[day];
  if(!st) return;
  st.playing = false;
  if(st.rafId) cancelAnimationFrame(st.rafId);
  st.rafId = null;
  const status = document.getElementById(`map-status-${day}`);
  if(status) status.textContent = 'Paused ‚Ä¢ bisa lanjut lagi atau replay dari awal';
  btn.textContent = '‚ñ∂ Resume';
}

/* ======= BUTTON HANDLER (ON/OFF) ======= */
document.addEventListener('click', e=>{
  const btn = e.target.closest('.anim-btn');
  if(!btn) return;
  const day = Number(btn.dataset.day);
  const st = mapStates[day];
  if(!st){
    const status = document.getElementById(`map-status-${day}`);
    if(status) status.textContent = 'Route belum tersedia / gagal dibaca.';
    return;
  }
  if(!st.playing){
    startAnimation(day, btn);
  }else{
    stopAnimation(day, btn);
  }
});
</script>

</body>
</html>
